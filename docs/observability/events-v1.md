# äº‹ä»¶å­—å…¸ v1

**ç‰ˆæœ¬**: v1.0.0  
**æœ€å¾Œæ›´æ–°**: 2025-11-09

æœ¬æ–‡æ¡£å®šä¹‰åº”ç”¨ç¨‹åºçš„äº‹ä»¶å­—å…¸ï¼ŒåŒ…æ‹¬äº‹ä»¶åç§°ã€å­—æ®µç»“æ„å’Œ GDPR åŒ¿ååŒ–ç­–ç•¥ã€‚

## ğŸ“‹ ç›®éŒ„

- [äº‹ä»¶æ¦‚è¦½](#äº‹ä»¶æ¦‚è¦½)
- [é€šç”¨å­—æ®µ](#é€šç”¨å­—æ®µ)
- [äº‹ä»¶å®šç¾©](#äº‹ä»¶å®šç¾©)
- [GDPR åŒ¿ååŒ–ç­–ç•¥](#gdpr-åŒ¿ååŒ–ç­–ç•¥)
- [äº‹ä»¶æµç¨‹](#äº‹ä»¶æµç¨‹)
- [ç›£æ§æŒ‡æ¨™](#ç›£æ§æŒ‡æ¨™)

## ğŸ” äº‹ä»¶æ¦‚è¦½

### äº‹ä»¶åˆ—è¡¨

| äº‹ä»¶åç¨± | è§¸ç™¼æ™‚æ©Ÿ | èªªæ˜ | é¡åˆ¥ |
|---------|---------|------|------|
| `upload_start` | ç”¨æˆ¶é–‹å§‹ä¸Šå‚³åœ–ç‰‡ | ç”¨æˆ¶é¸æ“‡åœ–ç‰‡ä¸¦é–‹å§‹ä¸Šå‚³æ™‚è§¸ç™¼ | Upload |
| `upload_ok` | åœ–ç‰‡ä¸Šå‚³æˆåŠŸ | åœ–ç‰‡æˆåŠŸä¸Šå‚³åˆ°æœå‹™å™¨æ™‚è§¸ç™¼ | Upload |
| `upload_fail` | åœ–ç‰‡ä¸Šå‚³å¤±æ•— | åœ–ç‰‡ä¸Šå‚³å¤±æ•—æ™‚è§¸ç™¼ | Upload |
| `gen_start` | é–‹å§‹ç”Ÿæˆåœ–ç‰‡ | ç”¨æˆ¶æäº¤ç”Ÿæˆè«‹æ±‚æ™‚è§¸ç™¼ | Generation |
| `gen_ok` | åœ–ç‰‡ç”ŸæˆæˆåŠŸ | åœ–ç‰‡æˆåŠŸç”Ÿæˆæ™‚è§¸ç™¼ | Generation |
| `gen_fail` | åœ–ç‰‡ç”Ÿæˆå¤±æ•— | åœ–ç‰‡ç”Ÿæˆå¤±æ•—æ™‚è§¸ç™¼ | Generation |
| `preview_view` | é è¦½åœ–ç‰‡ | ç”¨æˆ¶æŸ¥çœ‹ç”Ÿæˆçš„åœ–ç‰‡é è¦½æ™‚è§¸ç™¼ | Preview |
| `pay_start` | é–‹å§‹æ”¯ä»˜ | ç”¨æˆ¶é»æ“Šæ”¯ä»˜æŒ‰éˆ•æ™‚è§¸ç™¼ | Payment |
| `pay_success` | æ”¯ä»˜æˆåŠŸ | æ”¯ä»˜æˆåŠŸå®Œæˆæ™‚è§¸ç™¼ | Payment |
| `pay_fail` | æ”¯ä»˜å¤±æ•— | æ”¯ä»˜å¤±æ•—æ™‚è§¸ç™¼ | Payment |
| `download_click` | é»æ“Šä¸‹è¼‰ | ç”¨æˆ¶é»æ“Šä¸‹è¼‰æŒ‰éˆ•æ™‚è§¸ç™¼ | Download |
| `login_request` | ç™»å…¥è«‹æ±‚ | ç”¨æˆ¶ç™¼èµ·ç™»å…¥è«‹æ±‚æ™‚è§¸ç™¼ | Auth |
| `login_ok` | ç™»å…¥æˆåŠŸ | ç”¨æˆ¶æˆåŠŸç™»å…¥æ™‚è§¸ç™¼ | Auth |
| `login_fail` | ç™»å…¥å¤±æ•— | ç™»å…¥å¤±æ•—æ™‚è§¸ç™¼ | Auth |
| `logout` | ç™»å‡º | ç”¨æˆ¶ç™»å‡ºæ™‚è§¸ç™¼ | Auth |

**æ³¨æ„**: æœ¬æ–‡æ¡£åˆ—å‡º 12 å€‹æ ¸å¿ƒäº‹ä»¶ï¼ˆä¸åŒ…æ‹¬ `upload_fail`, `gen_fail`, `pay_fail` çš„è©³ç´°å®šç¾©ï¼Œä½†åŒ…å«åœ¨äº‹ä»¶åˆ—è¡¨ä¸­ï¼‰ã€‚

## ğŸ”’ é€šç”¨å­—æ®µ

### æ‰€æœ‰äº‹ä»¶é€šç”¨å­—æ®µ

æ‰€æœ‰äº‹ä»¶éƒ½åŒ…å«ä»¥ä¸‹é€šç”¨å­—æ®µï¼š

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | äº‹ä»¶åç¨± | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` (ISO 8601) | âœ… | äº‹ä»¶æ™‚é–“æˆ³ï¼ˆUTCï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | äº‹ä»¶ä¾†æºï¼ˆclient / serverï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆç™»å…¥å‰ç‚º nullï¼‰ | åŒ¿ååŒ–ï¼ˆè¦‹ä¸‹æ–¹ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `session_id` | `string \| null` | âšª | æœƒè©± IDï¼ˆç”¨æ–¼è¿½è¹¤ç”¨æˆ¶æœƒè©±ï¼‰ | åŒ¿ååŒ–ï¼ˆè¦‹ä¸‹æ–¹ï¼‰ |
| `ip_hash` | `string \| null` | âšª | IP åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `user_agent_hash` | `string \| null` | âšª | User Agent çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |

### å­—æ®µèªªæ˜

#### `user_id`
- **é¡å‹**: `string | null`
- **èªªæ˜**: Supabase ç”¨æˆ¶ ID
- **GDPR åŒ¿ååŒ–**: 
  - **ç­–ç•¥**: ä½¿ç”¨ UUID v4ï¼ˆå·²åŒ¿ååŒ–ï¼‰
  - **è™•ç†**: ç„¡éœ€é¡å¤–è™•ç†ï¼ŒUUID æœ¬èº«ä¸åŒ…å«å€‹äººä¿¡æ¯
  - **ä¿ç•™**: ä¿ç•™åŸå§‹ UUIDï¼Œç”¨æ–¼é—œè¯ç”¨æˆ¶è¡Œç‚º

#### `email_hash`
- **é¡å‹**: `string | null`
- **èªªæ˜**: Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ï¼ˆç”¨æ–¼éš±ç§ä¿è­·ï¼‰
- **GDPR åŒ¿ååŒ–**: 
  - **ç­–ç•¥**: ä½¿ç”¨ SHA-256 é›œæ¹Š Email åœ°å€
  - **è¨ˆç®—æ–¹å¼**: `SHA-256(email.toLowerCase().trim())`
  - **è™•ç†**: ä¸è¨˜éŒ„åŸå§‹ Emailï¼Œåªè¨˜éŒ„é›œæ¹Šå€¼
  - **ç”¨é€”**: ç”¨æ–¼çµ±è¨ˆå’Œåˆ†æï¼Œç„¡æ³•é€†å‘é‚„åŸåŸå§‹ Email

#### `session_id`
- **é¡å‹**: `string | null`
- **èªªæ˜**: æœƒè©± IDï¼ˆç”¨æ–¼è¿½è¹¤ç”¨æˆ¶æœƒè©±ï¼‰
- **GDPR åŒ¿ååŒ–**: 
  - **ç­–ç•¥**: ä½¿ç”¨ UUID v4ï¼ˆå·²åŒ¿ååŒ–ï¼‰
  - **è™•ç†**: ç„¡éœ€é¡å¤–è™•ç†ï¼ŒUUID æœ¬èº«ä¸åŒ…å«å€‹äººä¿¡æ¯
  - **ä¿ç•™**: ä¿ç•™åŸå§‹ UUIDï¼Œç”¨æ–¼é—œè¯æœƒè©±è¡Œç‚º

#### `ip_hash`
- **é¡å‹**: `string | null`
- **èªªæ˜**: IP åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ï¼ˆç”¨æ–¼éš±ç§ä¿è­·ï¼‰
- **GDPR åŒ¿ååŒ–**: 
  - **ç­–ç•¥**: ä½¿ç”¨ SHA-256 é›œæ¹Š IP åœ°å€
  - **è¨ˆç®—æ–¹å¼**: `SHA-256(ip_address)`
  - **è™•ç†**: ä¸è¨˜éŒ„åŸå§‹ IPï¼Œåªè¨˜éŒ„é›œæ¹Šå€¼
  - **ç”¨é€”**: ç”¨æ–¼çµ±è¨ˆå’Œåˆ†æï¼Œç„¡æ³•é€†å‘é‚„åŸåŸå§‹ IP

#### `user_agent_hash`
- **é¡å‹**: `string | null`
- **èªªæ˜**: User Agent çš„ SHA-256 é›œæ¹Šå€¼ï¼ˆç”¨æ–¼éš±ç§ä¿è­·ï¼‰
- **GDPR åŒ¿ååŒ–**: 
  - **ç­–ç•¥**: ä½¿ç”¨ SHA-256 é›œæ¹Š User Agent
  - **è¨ˆç®—æ–¹å¼**: `SHA-256(user_agent)`
  - **è™•ç†**: ä¸è¨˜éŒ„åŸå§‹ User Agentï¼Œåªè¨˜éŒ„é›œæ¹Šå€¼
  - **ç”¨é€”**: ç”¨æ–¼çµ±è¨ˆå’Œåˆ†æï¼Œç„¡æ³•é€†å‘é‚„åŸåŸå§‹ User Agent

## ğŸ“Š äº‹ä»¶å®šç¾©

### 1. upload_start

**è§¸ç™¼æ™‚æ©Ÿ**: ç”¨æˆ¶é–‹å§‹ä¸Šå‚³åœ–ç‰‡ï¼ˆé¸æ“‡åœ–ç‰‡ä¸¦é–‹å§‹ä¸Šå‚³ï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"upload_start"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"client"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆç™»å…¥å‰ç‚º nullï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `file_count` | `number` | âšª | ä¸Šå‚³çš„åœ–ç‰‡æ•¸é‡ | ç„¡éœ€åŒ¿ååŒ– |
| `total_size` | `number` | âšª | ç¸½æ–‡ä»¶å¤§å°ï¼ˆå­—ç¯€ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `file_types` | `string[]` | âšª | æ–‡ä»¶é¡å‹åˆ—è¡¨ï¼ˆå¦‚ `["image/jpeg", "image/png"]`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "upload_start",
  "ts": "2025-11-09T13:53:46.123Z",
  "source": "client",
  "user_id": null,
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "file_count": 3,
  "total_size": 5242880,
  "file_types": ["image/jpeg", "image/png"]
}
```

### 2. upload_ok

**è§¸ç™¼æ™‚æ©Ÿ**: åœ–ç‰‡ä¸Šå‚³æˆåŠŸï¼ˆåœ–ç‰‡æˆåŠŸä¸Šå‚³åˆ°æœå‹™å™¨ï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"upload_ok"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"server"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆç™»å…¥å‰ç‚º nullï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `file_count` | `number` | âšª | æˆåŠŸä¸Šå‚³çš„åœ–ç‰‡æ•¸é‡ | ç„¡éœ€åŒ¿ååŒ– |
| `upload_duration` | `number` | âšª | ä¸Šå‚³è€—æ™‚ï¼ˆæ¯«ç§’ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `file_ids` | `string[]` | âšª | æ–‡ä»¶ ID åˆ—è¡¨ï¼ˆUUIDï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "upload_ok",
  "ts": "2025-11-09T13:53:50.456Z",
  "source": "server",
  "user_id": null,
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "file_count": 3,
  "upload_duration": 4321,
  "file_ids": ["550e8400-e29b-41d4-a716-446655440001", "550e8400-e29b-41d4-a716-446655440002"]
}
```

### 3. gen_start

**è§¸ç™¼æ™‚æ©Ÿ**: é–‹å§‹ç”Ÿæˆåœ–ç‰‡ï¼ˆç”¨æˆ¶æäº¤ç”Ÿæˆè«‹æ±‚ï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"gen_start"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"client"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆç™»å…¥å‰ç‚º nullï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `job_id` | `string` | âœ… | ä»»å‹™ IDï¼ˆUUIDï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `style` | `string` | âšª | é¢¨æ ¼åç¨±ï¼ˆå¦‚ `"vintage"`, `"modern"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `template` | `string` | âšª | æ¨¡æ¿åç¨±ï¼ˆå¦‚ `"family_portrait"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `quality` | `string` | âšª | ç•«è³ªç­‰ç´šï¼ˆå¦‚ `"low"`, `"medium"`, `"high"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "gen_start",
  "ts": "2025-11-09T13:54:00.789Z",
  "source": "client",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "job_id": "550e8400-e29b-41d4-a716-446655440010",
  "style": "vintage",
  "template": "family_portrait",
  "quality": "high"
}
```

### 4. gen_ok

**è§¸ç™¼æ™‚æ©Ÿ**: åœ–ç‰‡ç”ŸæˆæˆåŠŸï¼ˆåœ–ç‰‡æˆåŠŸç”Ÿæˆï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"gen_ok"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"server"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆç™»å…¥å‰ç‚º nullï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `job_id` | `string` | âœ… | ä»»å‹™ IDï¼ˆUUIDï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `generation_duration` | `number` | âšª | ç”Ÿæˆè€—æ™‚ï¼ˆæ¯«ç§’ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `result_count` | `number` | âšª | ç”Ÿæˆçµæœæ•¸é‡ | ç„¡éœ€åŒ¿ååŒ– |
| `result_urls` | `string[]` | âšª | çµæœ URL åˆ—è¡¨ï¼ˆå·²åŒ¿ååŒ–ï¼Œä¸åŒ…å«å€‹äººä¿¡æ¯ï¼‰ | URLï¼ˆå·²åŒ¿ååŒ–ï¼‰ |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "gen_ok",
  "ts": "2025-11-09T13:54:45.123Z",
  "source": "server",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "job_id": "550e8400-e29b-41d4-a716-446655440010",
  "generation_duration": 44234,
  "result_count": 4,
  "result_urls": ["https://cdn.example.com/results/550e8400-e29b-41d4-a716-446655440010/1.jpg"]
}
```

### 5. preview_view

**è§¸ç™¼æ™‚æ©Ÿ**: é è¦½åœ–ç‰‡ï¼ˆç”¨æˆ¶æŸ¥çœ‹ç”Ÿæˆçš„åœ–ç‰‡é è¦½ï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"preview_view"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"client"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆç™»å…¥å‰ç‚º nullï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `job_id` | `string` | âœ… | ä»»å‹™ IDï¼ˆUUIDï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `result_index` | `number` | âšª | çµæœç´¢å¼•ï¼ˆå¦‚ `0`, `1`, `2`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `view_duration` | `number` | âšª | æŸ¥çœ‹è€—æ™‚ï¼ˆæ¯«ç§’ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "preview_view",
  "ts": "2025-11-09T13:55:00.456Z",
  "source": "client",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "job_id": "550e8400-e29b-41d4-a716-446655440010",
  "result_index": 0,
  "view_duration": 5000
}
```

### 6. pay_start

**è§¸ç™¼æ™‚æ©Ÿ**: é–‹å§‹æ”¯ä»˜ï¼ˆç”¨æˆ¶é»æ“Šæ”¯ä»˜æŒ‰éˆ•ï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"pay_start"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"client"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆç™»å…¥å‰ç‚º nullï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `job_id` | `string` | âœ… | ä»»å‹™ IDï¼ˆUUIDï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `order_id` | `string \| null` | âšª | è¨‚å–® IDï¼ˆUUIDï¼Œå¦‚æœå·²å‰µå»ºï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `amount` | `number` | âšª | æ”¯ä»˜é‡‘é¡ï¼ˆåˆ†ï¼Œå¦‚ `999` è¡¨ç¤º $9.99ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `currency` | `string` | âšª | è²¨å¹£ä»£ç¢¼ï¼ˆå¦‚ `"USD"`, `"EUR"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `payment_method` | `string` | âšª | æ”¯ä»˜æ–¹å¼ï¼ˆå¦‚ `"paypal"`, `"stripe"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "pay_start",
  "ts": "2025-11-09T13:55:30.789Z",
  "source": "client",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "job_id": "550e8400-e29b-41d4-a716-446655440010",
  "order_id": null,
  "amount": 999,
  "currency": "USD",
  "payment_method": "paypal"
}
```

### 7. pay_success

**è§¸ç™¼æ™‚æ©Ÿ**: æ”¯ä»˜æˆåŠŸï¼ˆæ”¯ä»˜æˆåŠŸå®Œæˆï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"pay_success"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"server"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆç™»å…¥å‰ç‚º nullï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `job_id` | `string` | âœ… | ä»»å‹™ IDï¼ˆUUIDï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `order_id` | `string` | âœ… | è¨‚å–® IDï¼ˆUUIDï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `amount` | `number` | âšª | æ”¯ä»˜é‡‘é¡ï¼ˆåˆ†ï¼Œå¦‚ `999` è¡¨ç¤º $9.99ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `currency` | `string` | âšª | è²¨å¹£ä»£ç¢¼ï¼ˆå¦‚ `"USD"`, `"EUR"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `payment_method` | `string` | âšª | æ”¯ä»˜æ–¹å¼ï¼ˆå¦‚ `"paypal"`, `"stripe"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `payment_duration` | `number` | âšª | æ”¯ä»˜è€—æ™‚ï¼ˆæ¯«ç§’ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "pay_success",
  "ts": "2025-11-09T13:56:00.123Z",
  "source": "server",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "job_id": "550e8400-e29b-41d4-a716-446655440010",
  "order_id": "550e8400-e29b-41d4-a716-446655440020",
  "amount": 999,
  "currency": "USD",
  "payment_method": "paypal",
  "payment_duration": 29377
}
```

### 8. download_click

**è§¸ç™¼æ™‚æ©Ÿ**: é»æ“Šä¸‹è¼‰ï¼ˆç”¨æˆ¶é»æ“Šä¸‹è¼‰æŒ‰éˆ•ï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"download_click"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"client"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆç™»å…¥å‰ç‚º nullï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `job_id` | `string` | âœ… | ä»»å‹™ IDï¼ˆUUIDï¼‰ | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `result_index` | `number` | âšª | çµæœç´¢å¼•ï¼ˆå¦‚ `0`, `1`, `2`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `quality` | `string` | âšª | ä¸‹è¼‰ç•«è³ªï¼ˆå¦‚ `"low"`, `"medium"`, `"high"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "download_click",
  "ts": "2025-11-09T13:56:30.456Z",
  "source": "client",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "job_id": "550e8400-e29b-41d4-a716-446655440010",
  "result_index": 0,
  "quality": "high"
}
```

### 9. login_request

**è§¸ç™¼æ™‚æ©Ÿ**: ç™»å…¥è«‹æ±‚ï¼ˆç”¨æˆ¶ç™¼èµ·ç™»å…¥è«‹æ±‚ï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"login_request"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"client"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `null` | âœ… | ç™»å…¥å‰ç‚º `null` | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string` | âœ… | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `email_domain` | `string` | âšª | Email åŸŸåï¼ˆå¯é¸ï¼Œç”¨æ–¼åˆ†æï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "login_request",
  "ts": "2025-11-09T13:57:00.789Z",
  "source": "client",
  "user_id": null,
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "email_domain": "example.com"
}
```

### 10. login_ok

**è§¸ç™¼æ™‚æ©Ÿ**: ç™»å…¥æˆåŠŸï¼ˆç”¨æˆ¶æˆåŠŸç™»å…¥ï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"login_ok"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"server"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string` | âœ… | ç”¨æˆ¶ ID | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string` | âœ… | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `method` | `string` | âšª | ç™»å…¥æ–¹å¼ï¼ˆå¦‚ `"magic_link"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "login_ok",
  "ts": "2025-11-09T13:57:30.123Z",
  "source": "server",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "method": "magic_link"
}
```

### 11. login_fail

**è§¸ç™¼æ™‚æ©Ÿ**: ç™»å…¥å¤±æ•—ï¼ˆç™»å…¥å¤±æ•—ï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"login_fail"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"server"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string \| null` | âš ï¸ | ç”¨æˆ¶ IDï¼ˆå¦‚æœå¯ç²å–ï¼‰æˆ– `null` | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string \| null` | âš ï¸ | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ï¼ˆå¦‚æœå¯ç²å–ï¼‰æˆ– `null` | å·²åŒ¿ååŒ– |
| `error_code` | `string` | âšª | éŒ¯èª¤ä»£ç¢¼ï¼ˆå¦‚ `"invalid_code"`, `"expired_code"`ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |
| `error_message` | `string` | âšª | éŒ¯èª¤è¨Šæ¯ï¼ˆç°¡çŸ­æè¿°ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "login_fail",
  "ts": "2025-11-09T13:57:45.456Z",
  "source": "server",
  "user_id": null,
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "error_code": "invalid_code",
  "error_message": "Invalid or expired authorization code"
}
```

### 12. logout

**è§¸ç™¼æ™‚æ©Ÿ**: ç™»å‡ºï¼ˆç”¨æˆ¶ç™»å‡ºï¼‰

**å­—æ®µçµæ§‹**:

| å­—æ®µåç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ | GDPR åŒ¿ååŒ– |
|---------|------|------|------|------------|
| `event` | `string` | âœ… | `"logout"` | ç„¡éœ€åŒ¿ååŒ– |
| `ts` | `string` | âœ… | äº‹ä»¶æ™‚é–“æˆ³ | ç„¡éœ€åŒ¿ååŒ– |
| `source` | `string` | âœ… | `"client"` æˆ– `"server"` | ç„¡éœ€åŒ¿ååŒ– |
| `user_id` | `string` | âœ… | ç”¨æˆ¶ ID | UUIDï¼ˆå·²åŒ¿ååŒ–ï¼‰ |
| `email_hash` | `string` | âœ… | Email åœ°å€çš„ SHA-256 é›œæ¹Šå€¼ | å·²åŒ¿ååŒ– |
| `session_duration` | `number` | âšª | æœƒè©±æŒçºŒæ™‚é–“ï¼ˆç§’ï¼‰ | ç„¡éœ€åŒ¿ååŒ– |

**æ¨£ä¾‹ Payload**:

```json
{
  "event": "logout",
  "ts": "2025-11-09T14:30:00.789Z",
  "source": "client",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email_hash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "session_duration": 2160
}
```

## ğŸ”’ GDPR åŒ¿ååŒ–ç­–ç•¥

### åŒ¿ååŒ–åŸå‰‡

1. **æœ€å°åŒ–åŸå‰‡**: åªæ”¶é›†å¿…è¦çš„æ•¸æ“šï¼Œä¸æ”¶é›†ä¸å¿…è¦çš„å€‹äººä¿¡æ¯
2. **åŒ¿ååŒ–åŸå‰‡**: å°å€‹äººä¿¡æ¯é€²è¡ŒåŒ¿ååŒ–è™•ç†ï¼Œä½¿ç”¨é›œæ¹Šå€¼ä»£æ›¿åŸå§‹å€¼
3. **ä¿ç•™åŸå‰‡**: ä¿ç•™å¿…è¦çš„é—œè¯ä¿¡æ¯ï¼ˆå¦‚ UUIDï¼‰ï¼Œç”¨æ–¼é—œè¯ç”¨æˆ¶è¡Œç‚º
4. **åˆªé™¤åŸå‰‡**: å®šæœŸåˆªé™¤éæœŸæ•¸æ“šï¼Œç¬¦åˆ GDPR æ•¸æ“šä¿ç•™è¦æ±‚

### åŒ¿ååŒ–æ–¹æ³•

#### 1. Email åœ°å€åŒ¿ååŒ–

**æ–¹æ³•**: SHA-256 é›œæ¹Š

**è™•ç†æµç¨‹**:
1. å°‡ Email è½‰æ›ç‚ºå°å¯«ä¸¦å»é™¤ç©ºæ ¼
2. ä½¿ç”¨ SHA-256 é›œæ¹Š Email åœ°å€
3. åªè¨˜éŒ„é›œæ¹Šå€¼ï¼Œä¸è¨˜éŒ„åŸå§‹ Email

**è¨ˆç®—æ–¹å¼**:
```
email_hash = SHA-256(email.toLowerCase().trim())
```

**ç¯„ä¾‹**:
```
åŸå§‹ Email: "user@example.com"
é›œæ¹Šå€¼: "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3"
```

#### 2. IP åœ°å€åŒ¿ååŒ–

**æ–¹æ³•**: SHA-256 é›œæ¹Š

**è™•ç†æµç¨‹**:
1. ç²å– IP åœ°å€ï¼ˆIPv4 æˆ– IPv6ï¼‰
2. ä½¿ç”¨ SHA-256 é›œæ¹Š IP åœ°å€
3. åªè¨˜éŒ„é›œæ¹Šå€¼ï¼Œä¸è¨˜éŒ„åŸå§‹ IP

**è¨ˆç®—æ–¹å¼**:
```
ip_hash = SHA-256(ip_address)
```

**ç¯„ä¾‹**:
```
åŸå§‹ IP: "192.168.1.1"
é›œæ¹Šå€¼: "b3a3c3d3e3f3g3h3i3j3k3l3m3n3o3p3q3r3s3t3u3v3w3x3y3z3a3b3c3d3e3f3"
```

#### 3. User Agent åŒ¿ååŒ–

**æ–¹æ³•**: SHA-256 é›œæ¹Š

**è™•ç†æµç¨‹**:
1. ç²å– User Agent å­—ç¬¦ä¸²
2. ä½¿ç”¨ SHA-256 é›œæ¹Š User Agent
3. åªè¨˜éŒ„é›œæ¹Šå€¼ï¼Œä¸è¨˜éŒ„åŸå§‹ User Agent

**è¨ˆç®—æ–¹å¼**:
```
user_agent_hash = SHA-256(user_agent)
```

**ç¯„ä¾‹**:
```
åŸå§‹ User Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
é›œæ¹Šå€¼: "c4b4d4e4f4g4h4i4j4k4l4m4n4o4p4q4r4s4t4u4v4w4x4y4z4a4b4c4d4e4f4"
```

#### 4. UUID åŒ¿ååŒ–

**æ–¹æ³•**: ä½¿ç”¨ UUID v4ï¼ˆå·²åŒ¿ååŒ–ï¼‰

**è™•ç†æµç¨‹**:
1. ä½¿ç”¨ UUID v4 ç”Ÿæˆå”¯ä¸€æ¨™è­˜ç¬¦
2. UUID æœ¬èº«ä¸åŒ…å«å€‹äººä¿¡æ¯ï¼Œç„¡éœ€é¡å¤–è™•ç†
3. ä¿ç•™åŸå§‹ UUIDï¼Œç”¨æ–¼é—œè¯ç”¨æˆ¶è¡Œç‚º

**ç¯„ä¾‹**:
```
user_id: "550e8400-e29b-41d4-a716-446655440000"
job_id: "550e8400-e29b-41d4-a716-446655440010"
order_id: "550e8400-e29b-41d4-a716-446655440020"
```

### åŒ¿ååŒ–è¦å‰‡è¡¨

| å­—æ®µé¡å‹ | åŒ¿ååŒ–æ–¹æ³• | è™•ç†æ–¹å¼ | ä¿ç•™åŸå§‹å€¼ | ç”¨é€” |
|---------|-----------|---------|-----------|------|
| **Email** | SHA-256 é›œæ¹Š | ä¸è¨˜éŒ„åŸå§‹ Emailï¼Œåªè¨˜éŒ„é›œæ¹Šå€¼ | âŒ | çµ±è¨ˆå’Œåˆ†æ |
| **IP åœ°å€** | SHA-256 é›œæ¹Š | ä¸è¨˜éŒ„åŸå§‹ IPï¼Œåªè¨˜éŒ„é›œæ¹Šå€¼ | âŒ | çµ±è¨ˆå’Œåˆ†æ |
| **User Agent** | SHA-256 é›œæ¹Š | ä¸è¨˜éŒ„åŸå§‹ User Agentï¼Œåªè¨˜éŒ„é›œæ¹Šå€¼ | âŒ | çµ±è¨ˆå’Œåˆ†æ |
| **UUID** | UUID v4 | ç„¡éœ€é¡å¤–è™•ç†ï¼ŒUUID æœ¬èº«ä¸åŒ…å«å€‹äººä¿¡æ¯ | âœ… | é—œè¯ç”¨æˆ¶è¡Œç‚º |
| **æ™‚é–“æˆ³** | ç„¡éœ€åŒ¿ååŒ– | è¨˜éŒ„åŸå§‹æ™‚é–“æˆ³ | âœ… | æ™‚é–“åºåˆ—åˆ†æ |
| **æ•¸å€¼** | ç„¡éœ€åŒ¿ååŒ– | è¨˜éŒ„åŸå§‹æ•¸å€¼ | âœ… | çµ±è¨ˆå’Œåˆ†æ |
| **å­—ç¬¦ä¸²** | ç„¡éœ€åŒ¿ååŒ– | è¨˜éŒ„åŸå§‹å­—ç¬¦ä¸²ï¼ˆä¸åŒ…å«å€‹äººä¿¡æ¯ï¼‰ | âœ… | åˆ†é¡å’Œåˆ†æ |

### æ•¸æ“šä¿ç•™ç­–ç•¥

**ä¿ç•™æœŸé™**:
- **äº‹ä»¶æ•¸æ“š**: ä¿ç•™ 30-90 å¤©
- **èšåˆæ•¸æ“š**: ä¿ç•™ 1-2 å¹´
- **åŒ¿ååŒ–æ•¸æ“š**: ä¿ç•™ 1-2 å¹´

**åˆªé™¤è¦å‰‡**:
- **è‡ªå‹•åˆªé™¤**: å®šæœŸæ¸…ç†éæœŸæ•¸æ“šï¼ˆæ¯é€±ä¸€æ¬¡ï¼‰
- **æ‰‹å‹•åˆªé™¤**: ç”¨æˆ¶è«‹æ±‚åˆªé™¤æ•¸æ“šæ™‚ç«‹å³åˆªé™¤
- **åˆè¦åˆªé™¤**: ç¬¦åˆ GDPR å’Œéš±ç§æ³•è¦è¦æ±‚

## ğŸ“‹ äº‹ä»¶æµç¨‹

### å®Œæ•´ç”¨æˆ¶æµç¨‹äº‹ä»¶åºåˆ—

```
1. login_request (client)
   â†“
2. login_ok (server) æˆ– login_fail (server)
   â†“
3. upload_start (client)
   â†“
4. upload_ok (server)
   â†“
5. gen_start (client)
   â†“
6. gen_ok (server)
   â†“
7. preview_view (client)
   â†“
8. pay_start (client)
   â†“
9. pay_success (server)
   â†“
10. download_click (client)
   â†“
11. logout (client/server)
```

### äº‹ä»¶æ™‚é–“ç·š

```
[login_request] â†’ [login_ok] â†’ [upload_start] â†’ [upload_ok] â†’ [gen_start] â†’ [gen_ok] â†’ [preview_view] â†’ [pay_start] â†’ [pay_success] â†’ [download_click] â†’ [logout]
```

## ğŸ” ç›£æ§æŒ‡æ¨™

### å»ºè­°ç›£æ§æŒ‡æ¨™

1. **ä¸Šå‚³æˆåŠŸç‡**
   - è¨ˆç®—: `upload_ok / (upload_start + upload_fail)`
   - ç›®æ¨™: > 95%

2. **ç”ŸæˆæˆåŠŸç‡**
   - è¨ˆç®—: `gen_ok / (gen_start + gen_fail)`
   - ç›®æ¨™: > 90%

3. **æ”¯ä»˜è½‰åŒ–ç‡**
   - è¨ˆç®—: `pay_success / pay_start`
   - ç›®æ¨™: > 80%

4. **ä¸‹è¼‰è½‰åŒ–ç‡**
   - è¨ˆç®—: `download_click / preview_view`
   - ç›®æ¨™: > 60%

5. **å¹³å‡ç”Ÿæˆæ™‚é–“**
   - è¨ˆç®—: `gen_ok.ts - gen_start.ts`
   - ç›®æ¨™: < 60 ç§’

6. **å¹³å‡æ”¯ä»˜æ™‚é–“**
   - è¨ˆç®—: `pay_success.ts - pay_start.ts`
   - ç›®æ¨™: < 30 ç§’

## ğŸ“¤ ç™¼é€ç›®çš„åœ°

### çŸ­æœŸæ–¹æ¡ˆ

**1. Console è¼¸å‡º**
- **æ ¼å¼**: JSON æ ¼å¼è¼¸å‡ºåˆ° `console.log`
- **æ¨™ç±¤**: æ·»åŠ  `type=event` æ¨™ç±¤ä»¥ä¾¿éæ¿¾
- **ç¯„ä¾‹**: `console.log('[EVENT]', JSON.stringify(payload))`

**2. Logflare æ¨™ç±¤**
- **æ ¼å¼**: ç™¼é€åˆ° Logflareï¼Œæ·»åŠ  `type=event` æ¨™ç±¤
- **æ¨™ç±¤**: `type=event`
- **ç”¨é€”**: ç”¨æ–¼éæ¿¾å’ŒæŸ¥è©¢äº‹ä»¶

### é•·æœŸæ–¹æ¡ˆï¼ˆæœªä¾†ï¼‰

- **å°ˆç”¨ç›£æ§æœå‹™**: å¦‚ Datadog, Sentry, æˆ–è‡ªå»ºç›£æ§ç³»çµ±
- **äº‹ä»¶æµ**: ç™¼é€åˆ°äº‹ä»¶æµï¼ˆå¦‚ Kafka, AWS EventBridgeï¼‰
- **æ•¸æ“šåº«**: å­˜å„²åˆ°æ™‚é–“åºåˆ—æ•¸æ“šåº«ï¼ˆå¦‚ InfluxDB, TimescaleDBï¼‰

## ğŸ“Š æ¨£ä¾‹æŸ¥è©¢

### Logflare æŸ¥è©¢ç¯„ä¾‹

```sql
-- æŸ¥è©¢æ‰€æœ‰äº‹ä»¶
type=event

-- æŸ¥è©¢ä¸Šå‚³äº‹ä»¶
type=event event=upload_start OR event=upload_ok

-- æŸ¥è©¢ç”Ÿæˆäº‹ä»¶
type=event event=gen_start OR event=gen_ok

-- æŸ¥è©¢æ”¯ä»˜äº‹ä»¶
type=event event=pay_start OR event=pay_success

-- æŸ¥è©¢ç™»å…¥äº‹ä»¶
type=event event=login_request OR event=login_ok OR event=login_fail
```

## ğŸ“š ç›¸é—œæ–‡æª”

- [Auth äº‹ä»¶ç›£æ§è¦ç¯„](./auth-events.md)
- [æ•¸æ“šä¿ç•™ç­–ç•¥](../db/retention.md)

## ğŸ“ æ›´æ–°æ—¥èªŒ

- **v1.0.0** (2025-11-09): åˆå§‹ç‰ˆæœ¬ï¼Œå®šç¾© 12 å€‹æ ¸å¿ƒäº‹ä»¶å’Œ GDPR åŒ¿ååŒ–ç­–ç•¥



