# MVP Generate Flow é©—æ”¶æŒ‡å—

**ç‰ˆæœ¬**: v1.0.0  
**å»ºç«‹æ—¥æœŸ**: 2025-11-13  
**ç›®æ¨™**: æä¾›å®Œæ•´çš„ Generate Flowï¼ˆMock ç‰ˆï¼‰é©—æ”¶æ­¥é©Ÿï¼Œç¢ºä¿ E2E è·¯å¾‘å¯é©—æ”¶

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡ä»¶æè¿°å¾ `/generate` â†’ `/results` â†’ `/orders` çš„å®Œæ•´ Mock æµç¨‹ï¼Œæ‰€æœ‰æ­¥é©Ÿéƒ½**ä¸éœ€è¦å¯¦éš›å¤–éƒ¨ API**ï¼Œé©åˆé–‹ç™¼èˆ‡æ¸¬è©¦ç’°å¢ƒã€‚

**å‰ç½®æ¢ä»¶**ï¼š
- `NEXT_PUBLIC_USE_MOCK=true` ç’°å¢ƒè®Šæ•¸å·²è¨­å®š
- ä¸éœ€è¦ä»»ä½•å¤–éƒ¨ API Keyï¼ˆRunwareã€FAL ç­‰ï¼‰
- ä¸éœ€è¦å¯¦éš›ç™»å…¥ï¼ˆMock æ¨¡å¼ä¸‹å¯è±å…èªè­‰ï¼‰

---

## ğŸ¯ å®Œæ•´æµç¨‹æ­¥é©Ÿ

### Step 1: é€²å…¥ Generate é é¢

1. **è¨ªå• `/generate`**
   - URL: `https://family-mosaic-maker.vercel.app/generate`
   - **é æœŸçµæœ**ï¼š
     - âœ… é é¢æ­£å¸¸è¼‰å…¥ï¼ˆHTTP 200ï¼‰
     - âœ… é¡¯ç¤ºä¸Šå‚³å€åŸŸï¼ˆUpload Cardï¼‰
     - âœ… é¡¯ç¤º Style é¸æ“‡ï¼ˆRealisticã€Animeã€Vintageï¼‰
     - âœ… é¡¯ç¤º Template é¸æ“‡ï¼ˆChristmasã€Birthdayã€Wedding ç­‰ï¼‰
     - âœ… é¡¯ç¤ºã€ŒGenerateã€æŒ‰éˆ•

2. **ä¸Šå‚³åœ–ç‰‡ï¼ˆMock æ¨¡å¼ï¼‰**
   - å¯ä»¥ä¸Šå‚³è‡³å°‘ä¸€å¼µåœ–ç‰‡ï¼ˆæˆ–ä½¿ç”¨ placeholderï¼‰
   - åœ¨ Mock æ¨¡å¼ä¸‹ï¼Œå³ä½¿ä¸ä¸Šå‚³çœŸå¯¦åœ–ç‰‡ä¹Ÿå¯ä»¥ç¹¼çºŒï¼ˆå‰ç«¯æœƒå‚³é€ mock file metadataï¼‰

3. **é¸æ“‡ Style å’Œ Template**
   - é¸æ“‡ä»»ä¸€ Styleï¼ˆä¾‹å¦‚ï¼šRealisticï¼‰
   - é¸æ“‡ä»»ä¸€ Templateï¼ˆä¾‹å¦‚ï¼šChristmasï¼‰

---

### Step 2: è§¸ç™¼ Generate

1. **é»æ“Šã€ŒGenerateã€æŒ‰éˆ•**
   - **é æœŸè¡Œç‚º**ï¼š
     - âœ… æŒ‰éˆ•é¡¯ç¤º loading ç‹€æ…‹
     - âœ… å‘¼å« `POST /api/generate`
     - âœ… æ”¶åˆ° `{ ok: true, jobId: "job_xxx" }` å›æ‡‰
     - âœ… è‡ªå‹•å°å‘ `/progress/{jobId}`

2. **Progress é é¢**
   - **é æœŸè¡Œç‚º**ï¼š
     - âœ… é¡¯ç¤ºé€²åº¦åœ“åœˆï¼ˆ0% â†’ 100%ï¼‰
     - âœ… é¡¯ç¤ºç‹€æ…‹è¨Šæ¯ï¼ˆ"Processing images..." â†’ "Generation complete!"ï¼‰
     - âœ… åœ¨ Mock æ¨¡å¼ä¸‹ï¼Œç´„ 90 ç§’å¾Œè‡ªå‹•å®Œæˆ
     - âœ… å®Œæˆå¾Œè‡ªå‹•å°å‘ `/results/{jobId}`

**ç‰¹æ®Šæ¸¬è©¦ï¼šdemo-001**
- å¦‚æœç›´æ¥è¨ªå• `/progress/demo-001`ï¼Œæ‡‰è©²**ç«‹å³**é¡¯ç¤º 100% ä¸¦å°å‘ `/results/demo-001`
- é€™æ˜¯ç‚ºäº† QA æ¸¬è©¦è€Œè¨­è¨ˆçš„å¿«é€Ÿè·¯å¾‘

---

### Step 3: æŸ¥çœ‹ Results

1. **Results é é¢**
   - URL: `/results/{jobId}` æˆ– `/results?id={jobId}`
   - **é æœŸè¡Œç‚º**ï¼š
     - âœ… é é¢æ­£å¸¸è¼‰å…¥ï¼ˆHTTP 200ï¼‰
     - âœ… é¡¯ç¤º 2-4 å¼µ Mock åœ–ç‰‡ï¼ˆä½¿ç”¨ `/assets/mock/family1.jpg` å’Œ `family2.jpg`ï¼‰
     - âœ… åœ–ç‰‡ä»¥ç¶²æ ¼æˆ–åˆ—è¡¨æ–¹å¼æ’åˆ—
     - âœ… é¡¯ç¤º Job ID

2. **æœªä»˜è²»ç‹€æ…‹ï¼ˆé è¨­ï¼‰**
   - **é æœŸ UI**ï¼š
     - âœ… åœ–ç‰‡å¯èƒ½æœ‰ watermark æç¤ºï¼ˆæˆ–é¡¯ç¤ºã€ŒUpgrade to Premiumã€æŒ‰éˆ•ï¼‰
     - âœ… æœ‰ã€ŒDownload HDã€æŒ‰éˆ•ï¼Œé»æ“Šæœƒæç¤ºå‡ç´š
     - âœ… æœ‰ã€ŒShareã€æŒ‰éˆ•
     - âœ… æœ‰ CTA æŒ‰éˆ•å¯ä»¥å› `/generate` æˆ– `/dashboard`

3. **å·²ä»˜è²»ç‹€æ…‹ï¼ˆæ¸¬è©¦ï¼‰**
   - URL: `/results/demo-001?paid=1` æˆ– `/results?id=demo-001&paid=1`
   - **é æœŸ UI**ï¼š
     - âœ… é¡¯ç¤ºã€ŒPremiumã€æˆ–ã€ŒPaidã€Badge
     - âœ… åœ–ç‰‡æ²’æœ‰ watermark
     - âœ… ã€ŒDownload HDã€æŒ‰éˆ•å¯ä»¥æ­£å¸¸ä½¿ç”¨
     - âœ… å…¶ä»–åŠŸèƒ½æ­£å¸¸

---

### Step 4: æŸ¥çœ‹ Orders

1. **Orders é é¢**
   - URL: `/orders`
   - **é æœŸè¡Œç‚º**ï¼š
     - âœ… é é¢æ­£å¸¸è¼‰å…¥ï¼ˆHTTP 200ï¼‰
     - âœ… é¡¯ç¤ºè¨‚å–®åˆ—è¡¨ï¼ˆè‡³å°‘åŒ…å« demo-001 çš„è¨‚å–®ï¼‰
     - âœ… æ¯å€‹è¨‚å–®é¡¯ç¤ºï¼š
       - Job IDï¼ˆä¾‹å¦‚ï¼š`demo-001`ï¼‰
       - æ—¥æœŸ
       - ç‹€æ…‹ï¼ˆCompletedã€Processingï¼‰
       - ç¸®ç•¥åœ–
       - åœ–ç‰‡æ•¸é‡
       - Template åç¨±
       - ä»˜è²»ç‹€æ…‹ï¼ˆpaid/unpaidï¼‰

2. **è¨‚å–®è©³æƒ…**
   - é»æ“Šè¨‚å–®å¯ä»¥æŸ¥çœ‹è©³æƒ…ï¼ˆå¦‚æœå¯¦ä½œï¼‰
   - æˆ–é»æ“Šã€ŒViewã€æŒ‰éˆ•å°å‘ `/results/{jobId}`

---

## âœ… é©—æ”¶ Checklist

### åŸºæœ¬åŠŸèƒ½

- [ ] `/generate` é é¢æ­£å¸¸è¼‰å…¥
- [ ] å¯ä»¥é¸æ“‡ Style å’Œ Template
- [ ] é»æ“Šã€ŒGenerateã€å¾ŒæˆåŠŸå‰µå»º job
- [ ] `/progress/{jobId}` é¡¯ç¤ºé€²åº¦ä¸¦è‡ªå‹•å°å‘
- [ ] `/results/{jobId}` é¡¯ç¤º Mock åœ–ç‰‡
- [ ] `/orders` é¡¯ç¤º Mock è¨‚å–®åˆ—è¡¨

### Mock åœ–ç‰‡

- [ ] Results é é¢é¡¯ç¤ºè‡³å°‘ 2 å¼µåœ–ç‰‡
- [ ] åœ–ç‰‡ URL ä½¿ç”¨æœ¬åœ°è³‡æºï¼ˆ`/assets/mock/family1.jpg` ç­‰ï¼‰
- [ ] åœ–ç‰‡æ­£å¸¸è¼‰å…¥ï¼ˆä¸é¡¯ç¤º broken imageï¼‰

### ä»˜è²»ç‹€æ…‹

- [ ] æœªä»˜è²»ç‹€æ…‹é¡¯ç¤ºæ­£ç¢º UIï¼ˆwatermark æç¤ºæˆ–å‡ç´šæŒ‰éˆ•ï¼‰
- [ ] `paid=1` query åƒæ•¸å¯ä»¥è§¸ç™¼å·²ä»˜è²»ç‹€æ…‹
- [ ] å·²ä»˜è²»ç‹€æ…‹é¡¯ç¤º Premium Badge

### å°èˆªèˆ‡ CTA

- [ ] Results é é¢æœ‰ã€Œå› Generateã€æˆ–ã€Œå› Dashboardã€æŒ‰éˆ•
- [ ] Orders é é¢å¯ä»¥å°å‘ Results é é¢
- [ ] æ‰€æœ‰å°èˆªé€£çµæ­£å¸¸é‹ä½œ

### API ç«¯é»

- [ ] `POST /api/generate` è¿”å› `{ ok: true, jobId: "..." }`
- [ ] `GET /api/progress/demo-001` è¿”å› `{ status: "succeeded", progress: 100 }`
- [ ] `GET /api/results/demo-001` è¿”å› `{ jobId: "demo-001", images: [...], paymentStatus: "unpaid" }`
- [ ] `GET /api/orders` è¿”å› `{ orders: [...] }`ï¼Œè‡³å°‘åŒ…å« demo-001

---

## ğŸ”§ æ¸¬è©¦å·¥å…·

### å¿«é€Ÿæ¸¬è©¦ï¼ˆä½¿ç”¨ demo-001ï¼‰

1. **ç›´æ¥æ¸¬è©¦ Results**ï¼š
   ```
   https://family-mosaic-maker.vercel.app/results?id=demo-001
   ```

2. **æ¸¬è©¦å·²ä»˜è²»ç‹€æ…‹**ï¼š
   ```
   https://family-mosaic-maker.vercel.app/results?id=demo-001&paid=1
   ```

3. **æ¸¬è©¦ Progress**ï¼š
   ```
   https://family-mosaic-maker.vercel.app/progress/demo-001
   ```
   ï¼ˆæ‡‰è©²ç«‹å³é¡¯ç¤º 100% ä¸¦å°å‘ Resultsï¼‰

### å®Œæ•´æµç¨‹æ¸¬è©¦

1. è¨ªå• `/generate`
2. é¸æ“‡ Style å’Œ Template
3. é»æ“Šã€ŒGenerateã€
4. ç­‰å¾… Progress å®Œæˆï¼ˆæˆ–ç›´æ¥è¨ªå• `/progress/demo-001`ï¼‰
5. æŸ¥çœ‹ Results
6. è¨ªå• `/orders` æŸ¥çœ‹è¨‚å–®åˆ—è¡¨

---

## ğŸ“ æ³¨æ„äº‹é …

1. **Mock æ¨¡å¼é™åˆ¶**ï¼š
   - æ‰€æœ‰åœ–ç‰‡éƒ½æ˜¯ Mock çš„ï¼Œä¸æœƒå¯¦éš›ç”Ÿæˆ
   - Job ID æ˜¯éš¨æ©Ÿç”Ÿæˆçš„ï¼ˆé™¤äº† demo-001ï¼‰
   - é€²åº¦æ˜¯æ¨¡æ“¬çš„ï¼ˆ90 ç§’å®Œæˆï¼‰

2. **èªè­‰è±å…**ï¼š
   - åœ¨ Mock æ¨¡å¼ä¸‹ï¼ŒæŸäº› API å¯èƒ½ä¸éœ€è¦ç™»å…¥
   - ä½† UI é é¢å¯èƒ½ä»éœ€è¦ç™»å…¥ï¼ˆä¾å°ˆæ¡ˆè¨­å®šï¼‰

3. **ç’°å¢ƒè®Šæ•¸**ï¼š
   - ç¢ºä¿ `NEXT_PUBLIC_USE_MOCK=true` å·²è¨­å®š
   - ä¸éœ€è¦è¨­å®š `FAL_API_KEY` æˆ– `RUNWARE_API_KEY`

---

## ğŸ› ç–‘é›£æ’è§£

### å•é¡Œï¼šGenerate æŒ‰éˆ•é»æ“Šå¾Œæ²’æœ‰åæ‡‰

**å¯èƒ½åŸå› **ï¼š
- API è¿”å›éŒ¯èª¤
- å‰ç«¯ JavaScript éŒ¯èª¤

**è§£æ±ºæ–¹æ³•**ï¼š
- æª¢æŸ¥ç€è¦½å™¨ Console æ˜¯å¦æœ‰éŒ¯èª¤
- æª¢æŸ¥ Network æ¨™ç±¤ï¼Œç¢ºèª `/api/generate` çš„è«‹æ±‚èˆ‡å›æ‡‰

### å•é¡Œï¼šResults é é¢é¡¯ç¤ºã€ŒJob not foundã€

**å¯èƒ½åŸå› **ï¼š
- Job ID ä¸å­˜åœ¨
- Mock æ¨¡å¼æœªå•Ÿç”¨

**è§£æ±ºæ–¹æ³•**ï¼š
- ä½¿ç”¨ `demo-001` æ¸¬è©¦ï¼ˆä¿è­‰å­˜åœ¨ï¼‰
- ç¢ºèª `NEXT_PUBLIC_USE_MOCK=true`

### å•é¡Œï¼šåœ–ç‰‡ç„¡æ³•è¼‰å…¥

**å¯èƒ½åŸå› **ï¼š
- åœ–ç‰‡è·¯å¾‘éŒ¯èª¤
- æœ¬åœ°è³‡æºä¸å­˜åœ¨

**è§£æ±ºæ–¹æ³•**ï¼š
- ç¢ºèª `public/assets/mock/family1.jpg` å’Œ `family2.jpg` å­˜åœ¨
- æª¢æŸ¥åœ–ç‰‡ URL æ˜¯å¦æ­£ç¢º

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [API å¥‘ç´„](./api/generate-contract.md) - è©³ç´°çš„ API ç«¯é»å®šç¾©
- [MVP E2E Checklist](./mvp-e2e-checklist.md) - æ•´é«” MVP é©—æ”¶æ¸…å–®

