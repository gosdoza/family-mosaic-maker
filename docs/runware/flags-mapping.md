# Runware Flags 映射表（Generation）

**版本**: v1.0.0  
**最後更新**: 2025-11-09

本文档说明 UI「低/中/高画质」选项与 Runware API 参数的映射关系，包括解析度、步数和灰度比例的对应关系。

## 📋 目錄

- [映射概述](#映射概述)
- [畫質等級定義](#畫質等級定義)
- [Flags 映射表](#flags-映射表)
- [參數說明](#參數說明)
- [使用場景](#使用場景)

## 🔍 映射概述

### 映射目的

將用戶在 UI 中選擇的畫質等級（低/中/高）轉換為 Runware API 的具體參數（解析度、步數、灰度比例），以提供不同品質的圖片生成選項。

### 映射關係

```
UI 畫質選項 → Runware API 參數
   ↓              ↓
低/中/高畫質   解析度、步數、灰度比例
```

### 映射原則

- **低畫質**: 快速生成，較低解析度，較少步數，較高灰度比例
- **中畫質**: 平衡生成速度和品質，中等解析度，中等步數，中等灰度比例
- **高畫質**: 高品質生成，高解析度，較多步數，較低灰度比例

## 📊 畫質等級定義

### 低畫質（Low Quality）

**目標**: 快速生成，適合預覽和測試

**特點**:
- 生成速度快
- 解析度較低
- 步數較少
- 灰度比例較高（節省資源）

**適用場景**:
- 快速預覽效果
- 測試不同風格和模板
- 網絡較慢時的降級選項
- 免費用戶的默認選項

### 中畫質（Medium Quality）

**目標**: 平衡生成速度和品質

**特點**:
- 生成速度中等
- 解析度中等
- 步數中等
- 灰度比例中等

**適用場景**:
- 一般用戶的推薦選項
- 平衡品質和速度
- 標準付費用戶的默認選項

### 高畫質（High Quality）

**目標**: 高品質生成，適合最終輸出

**特點**:
- 生成速度較慢
- 解析度較高
- 步數較多
- 灰度比例較低（更高品質）

**適用場景**:
- 最終輸出和下載
- 付費用戶的高級選項
- 需要高品質圖片的場景

## 📋 Flags 映射表

### 完整映射表

| UI 畫質選項 | 解析度（Resolution） | 步數（Steps） | 灰度比例（Grayscale Ratio） | 說明 |
|------------|---------------------|--------------|---------------------------|------|
| **低畫質** | 512x512 | 30 | 0.8 | 快速生成，適合預覽 |
| **中畫質** | 768x768 | 40 | 0.5 | 平衡品質和速度 |
| **高畫質** | 1024x1024 | 50 | 0.2 | 高品質生成，適合最終輸出 |

### 映射表說明

**解析度（Resolution）**:
- **低畫質**: 512x512 像素（較低解析度，快速生成）
- **中畫質**: 768x768 像素（中等解析度，平衡品質和速度）
- **高畫質**: 1024x1024 像素（高解析度，高品質生成）

**步數（Steps）**:
- **低畫質**: 30 步（較少步數，快速生成）
- **中畫質**: 40 步（中等步數，平衡品質和速度）
- **高畫質**: 50 步（較多步數，高品質生成）

**灰度比例（Grayscale Ratio）**:
- **低畫質**: 0.8（較高灰度比例，節省資源）
- **中畫質**: 0.5（中等灰度比例，平衡品質和資源）
- **高畫質**: 0.2（較低灰度比例，更高品質）

## 🔍 參數說明

### 解析度（Resolution）

**定義**: 生成圖片的像素尺寸（寬 x 高）

**影響**:
- **解析度越高**: 圖片品質越好，但生成時間越長，資源消耗越大
- **解析度越低**: 生成時間越短，資源消耗越小，但圖片品質較低

**選擇建議**:
- **低畫質（512x512）**: 適合快速預覽和測試，生成時間約 10-20 秒
- **中畫質（768x768）**: 適合一般使用，生成時間約 20-40 秒
- **高畫質（1024x1024）**: 適合最終輸出，生成時間約 40-60 秒

### 步數（Steps）

**定義**: 圖片生成的迭代步數

**影響**:
- **步數越多**: 圖片品質越好，細節更豐富，但生成時間越長
- **步數越少**: 生成時間越短，但圖片品質可能較低，細節較少

**選擇建議**:
- **低畫質（30 步）**: 快速生成，適合預覽，生成時間約 10-20 秒
- **中畫質（40 步）**: 平衡品質和速度，生成時間約 20-40 秒
- **高畫質（50 步）**: 高品質生成，適合最終輸出，生成時間約 40-60 秒

### 灰度比例（Grayscale Ratio）

**定義**: 圖片中灰度像素的比例（0.0 - 1.0）

**影響**:
- **灰度比例越高**: 圖片更偏向灰度，節省資源，但色彩豐富度較低
- **灰度比例越低**: 圖片色彩更豐富，品質更高，但資源消耗較大

**選擇建議**:
- **低畫質（0.8）**: 較高灰度比例，節省資源，適合快速生成
- **中畫質（0.5）**: 中等灰度比例，平衡品質和資源
- **高畫質（0.2）**: 較低灰度比例，色彩更豐富，適合高品質生成

## 🎯 使用場景

### 場景 1: 快速預覽（低畫質）

**用戶需求**: 快速查看生成效果，測試不同風格和模板

**參數選擇**:
- **解析度**: 512x512
- **步數**: 30
- **灰度比例**: 0.8

**預期效果**:
- 生成時間: 10-20 秒
- 圖片品質: 較低，適合預覽
- 資源消耗: 較低

### 場景 2: 一般使用（中畫質）

**用戶需求**: 平衡品質和速度，適合一般用戶使用

**參數選擇**:
- **解析度**: 768x768
- **步數**: 40
- **灰度比例**: 0.5

**預期效果**:
- 生成時間: 20-40 秒
- 圖片品質: 中等，適合一般使用
- 資源消耗: 中等

### 場景 3: 高品質輸出（高畫質）

**用戶需求**: 高品質圖片，適合最終輸出和下載

**參數選擇**:
- **解析度**: 1024x1024
- **步數**: 50
- **灰度比例**: 0.2

**預期效果**:
- 生成時間: 40-60 秒
- 圖片品質: 高品質，適合最終輸出
- 資源消耗: 較高

## 📊 參數對比表

### 解析度對比

| 畫質等級 | 解析度 | 像素數 | 相對大小 | 生成時間 |
|---------|--------|--------|---------|---------|
| **低畫質** | 512x512 | 262,144 | 1x | 10-20 秒 |
| **中畫質** | 768x768 | 589,824 | 2.25x | 20-40 秒 |
| **高畫質** | 1024x1024 | 1,048,576 | 4x | 40-60 秒 |

### 步數對比

| 畫質等級 | 步數 | 相對步數 | 生成時間 | 品質提升 |
|---------|------|---------|---------|---------|
| **低畫質** | 30 | 1x | 10-20 秒 | 基礎品質 |
| **中畫質** | 40 | 1.33x | 20-40 秒 | 中等品質 |
| **高畫質** | 50 | 1.67x | 40-60 秒 | 高品質 |

### 灰度比例對比

| 畫質等級 | 灰度比例 | 色彩豐富度 | 資源消耗 | 品質影響 |
|---------|---------|-----------|---------|---------|
| **低畫質** | 0.8 | 較低 | 較低 | 較低 |
| **中畫質** | 0.5 | 中等 | 中等 | 中等 |
| **高畫質** | 0.2 | 較高 | 較高 | 較高 |

## 🔄 動態調整

### 健康檢查降級

**場景**: 當 Runware API 健康檢查發現延遲或錯誤率過高時，自動降級參數

**降級規則**:
- **級別 1**: 高畫質 → 中畫質（1024x1024 → 768x768，50 → 40 步）
- **級別 2**: 中畫質 → 低畫質（768x768 → 512x512，40 → 30 步）
- **級別 3**: 低畫質 → 最低畫質（512x512 → 512x512，30 → 20 步）

### 用戶選擇優先級

**原則**: 用戶選擇的畫質等級優先於健康檢查降級

**處理方式**:
1. 首先應用用戶選擇的畫質等級
2. 如果健康檢查觸發降級，在用戶選擇的基礎上進一步降級
3. 如果健康檢查恢復正常，恢復到用戶選擇的畫質等級

## 📋 驗收命令

```bash
# 無
```

## 📚 相關文檔

- [Runware 供應商健康檢查](./health-check.md)
- [API 契約](../api/generate-contract.md)

## 📝 更新日誌

- **v1.0.0** (2025-11-09): 初始版本，定義 UI 畫質選項與 Runware API 參數的映射關係



